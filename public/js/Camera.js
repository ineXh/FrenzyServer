var ScreenPos={left:0,right:0,top:0,bot:0},getScreenPos=function(){ScreenPos.left=-stage.x,ScreenPos.right=-stage.x+width/stage.scale.x,ScreenPos.top=-stage.y,ScreenPos.bot=-stage.y+height/stage.scale.y},onScreen=function(e){if("path"==e._class)return!0;setBorder(e);var t=e.right<ScreenPos.left-.2*width,i=e.left>ScreenPos.right+.2*width,s=e.bot<ScreenPos.top-.2*height,h=e.top>ScreenPos.bot+.2*height;return!(i||t||h||s)},setBorder=function(e){e.left=e.x,e.right=e.x+e.width,e.top=e.y,e.bot=e.y+e.height},visiblecount=0,visibleCheck=function(){if(visiblecount++,visiblecount%40==0){visiblecount=0,getScreenPos();for(var e=0;e<stage.children.length;e++)onScreen(stage.children[e])?stage.children[e].visible=!0:stage.children[e].visible=!1}},panCenter=function(){void 0!=center&&(center.x>-stage.x+width/2+scope_width&&(stage.x=-(center.x-width/2-scope_width)),center.x<-stage.x+width/2-scope_width&&(stage.x=-(center.x-width/2+scope_width)),center.y>-stage.y+height/2+scope_height&&(stage.y=-(center.y-height/2-scope_height)),center.y<-stage.y+height/2-scope_height&&(stage.y=-(center.y-height/2+scope_height)))};