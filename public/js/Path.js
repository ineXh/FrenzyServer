function Path(a){this.team=a,this.points=[],this.line_pool=[],this.lines=[],this.radius=5,this.outer_radius=dim/5,this.maxline=3,this.num_lines=0,this.path_started=!1,this.init()}function seek(a,b){var c=PVector.sub(b,a.pos);c.normalize(),c.mult(a.maxspeed);var d=PVector.sub(c,a.vel);return d.limit(a.maxforce),d}Path.prototype={init:function(){this.debug=!0,this.path=new PIXI.Container,this.path._class="path",stage.addChild(this.path);for(var a=0;a<this.maxline;a++)this.line_pool.push(this.createArrow())},createArrow:function(){var a=new PIXI.Container;return a.pivot.x=0,a.pivot.y=0,arrow_line=new PIXI.Sprite(arrow_line_texture),arrow_line.anchor.x=0,arrow_line.anchor.y=.5,this.scale=width/20/arrow_line.width,arrow_line.scale.set(this.scale),arrow_line.width=0,arrow_line.x=0,arrow_line.y=0,arrow_line.tint=11154363,arrow_line.alpha=.2,a.addChild(arrow_line),arrow_head=new PIXI.Sprite(arrow_head_texture),arrow_head.scale.set(this.scale),arrow_head.anchor.x=.5,arrow_head.anchor.y=.5,arrow_head.x=0,arrow_head.y=0,arrow_head.tint=arrow_line.tint,arrow_head.alpha=arrow_line.alpha,a.addChild(arrow_head),a},addPoint:function(a,b){var c=new PVector(a,b);this.points.push(c)},getStart:function(){return this.points[0]},getEnd:function(){return this.points.length<=0?-1:this.points[this.points.length-1]},getEndLine:function(){return this.lines[this.lines.length-1]},getLastTwoPoints:function(){if(this.points.length<=1)return null;var a=[];return a.push(this.points[this.points.length-2]),a.push(this.points[this.points.length-1]),a},borrowline:function(){return this.line_pool.length>=1?this.line_pool.shift():(this.returnfirstline(),this.line_pool.shift())},returnfirstline:function(){this.points.splice(0,2),this.line_pool.push(this.lines.shift()),this.num_lines--},startPath:function(a,b){if(this.path_started)return void this.endPath(a,b);this.path_started=!0,this.addPoint(a,b);var c=this.borrowline();c.x=a,c.y=b,c.children[0].width=0,this.lines.push(c),c.children[0].tint=game.getTeam(this.team).color,c.children[1].tint=game.getTeam(this.team).color,this.path.addChild(c)},updatePath:function(a,b){this.path_started&&(p0=this.getEnd(),this.getEndLine().children[0].width=findDist(p0,new PVector(a,b)),this.getEndLine().children[1].x=this.getEndLine().children[0].width,this.getEndLine().rotation=Math.atan2(b-p0.y,a-p0.x))},endPath:function(a,b){this.path_started&&(this.updatePath(a,b),this.addPoint(a,b),this.num_lines++,this.path_started=!1)},drawPath:function(){for(var a=0;a<this.points.length-1;a++){var b=new PIXI.Graphics;b.lineStyle(30,170,.8);for(var c=this.points[a],d=this.points[a+1],e=findDist(c,d),f=new PIXI.Container,g=Math.floor(e/this.gap),h=0;g>h;h++)dot=new PIXI.Sprite(arrow_dot_texture),dot.anchor.x=.5,dot.anchor.y=.5,this.scale=3*this.gap/dot.width,dot.scale.set(this.scale),dot.x=(d.x-c.x)*h/(g+1)+c.x,dot.y=(d.y-c.y)*h/(g+1)+c.y,dot.tint=16776960,f.addChild(dot);b.moveTo(c.x,c.y),b.lineTo(d.x,d.y),this.path.addChild(b),this.path.addChild(f)}path_container.addChild(this.path)},follow:function(a){for(var b=new PVector(0,0),c=0;c<this.num_lines;c++){var d=this.points[2*c],e=this.points[2*c+1],f=getNormalPoint(a.pos,d,e);if(isBetween(f,d,e)&&withinDist(f,a.pos,this.outer_radius)){var g=PVector.sub(e,d);g.normalize();var h=g;b.add(h)}}return b.normalize(),b.mult(a.maxspeed),b},calculatefollowforce:function(a,b,c,d){var e=getNormalPoint(c,a,b),f=PVector.sub(b,a);f.normalize(),f.mult(50);var g=PVector.add(e,f);if(!isBetween(g,b,a))return new PVector(0,0);var h=PVector.dist(c,e);if(h>this.radius&&h<this.outer_radius){var i=seek(d,g);return i.mult(1),i}if(h<=this.radius){var i=b.clone();return i.sub(a),i.limit(1),i}return new PVector(0,0)}};