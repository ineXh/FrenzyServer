function Characters(){this.pool=new CharacterPool,this.init()}function Character(){this.SteerClosestTarget=1,this.SteerTargets=[],this.searchClosestTime=0,this.searchClosestTotalTime=2e3,this.closestTarget_idx=-1,this.accel=new PVector(0,0),this.vel=new PVector(0,0),this.pos=new PVector(0,0),this.maxspeed=width/100,this.Dead=!1}function Cow(){this.create()}function HealthBar(t){this.init(t)}Characters.prototype={init:function(){this.characters=this.pool.initList()},getLength:function(){return this.characters.length},update:function(){for(var t=0;t<this.characters.length;t++)if(void 0!=this.characters[t])for(var i=this.characters[t].length-1;i>=0;i--){var e=this.characters[t][i];if(e.update(),e.isDead()){this.clean(e);var s=this.characters[e.type].indexOf(t);if(s>-1){this.characters[e.type][s];this.characters[e.type].splice(s,1)}this.characters.splice(t,1)}}},spawn:function(t){var i=this.pool.borrowCharacter(t.type);return null!=i?(i.init(t),i):void 0},clean_all:function(){for(var t=this.characters.length-1;t>=0;t--){var i=this.characters[t];this.clean(i);var e=this.getCharacterlist(i.type).indexOf(t);if(e>-1){var s=this.getCharacterlist(i.type)[e];this.getCharacterlist(i.type).splice(e,1),this.decrementCharacterlists(s)}this.characters.splice(t,1)}},clean:function(t){t.clean(),this.pool.returnCharacter(t.type,t)},getCharacterlist:function(t){return this.characterlist[t]}},Character.prototype=Object.create(Ball.prototype),Character.prototype.constructor=Ball,Character.prototype.applyBehaviors=function(t){var i=this.steer(t);this.applyForce(i)},Character.prototype.addTarget=function(t,i){for(var e=0;e<t.length;e++)if(t[e]==i)return;t.push(i)},Character.prototype.removeTarget=function(t,i){for(var e=0;e<t.length;e++)if(t[e]==i)return void t.splice(e,1)},Character.prototype.findClosestTarget=function(t,i){if(null==this.targets)return-1;this.minDist_idx=-1,minDist=width;for(var e=0;e<t.length;e++){if(void 0!=t[e].target)var s=t[e].target;else var s=t[e];var a=findDist(i,s);a<minDist&&(void 0!=s.steer_distance?a<s.steer_distance&&(minDist=a,this.minDist_idx=e):(minDist=a,this.minDist_idx=e))}return this.minDist_idx},Character.prototype.steer=function(t){if(null==this.SteerTargets)return new PVector(0,0);if(this.SteerTargets.length<1)return new PVector(0,0);if(t.t-this.searchClosestTime>this.searchClosestTotalTime){for(var i=[],e=this.SteerTargets.length-1;e>=0;e--){var s=this.SteerTargets[e].target;s.isDead()?this.SteerTargets.splice(e,1):i.push(s.pos)}this.closestTarget_idx=this.findClosestTarget(i,this.pos),this.closestTarget_idx=this.SteerTargets.length-1-this.closestTarget_idx,this.searchClosestTime=t.t}var a=new PVector(0,0);if(-1!=this.closestTarget_idx&&void 0!=this.SteerTargets[this.closestTarget_idx]){if(withinDist(this.pos,this.SteerTargets[this.closestTarget_idx].target.pos,this.width+this.SteerTargets[this.closestTarget_idx].width))return a;a=this.seek(this.SteerTargets[this.closestTarget_idx].target.pos)}return a},Character.prototype.seek=function(t){var i=PVector.sub(t,this.pos);return i.normalize(),i.mult(this.maxspeed/2),i},Character.prototype.isDead=function(){return this.Dead},Cow.prototype=Object.create(Character.prototype),Cow.prototype.constructor=Character,Cow.prototype.create=function(){this.animationtype=AnimationType.Walk_Front,this.front_walk_frame=0,this.front_attack_frame=8,this.back_walk_frame=14,this.back_attack_frame=22,this.pos=new PVector(0,0),this.vel=new PVector(0,0),this.accel=new PVector(0,0),this.sprite=new PIXI.extras.MovieClip(cow_front_frames),this.sprite.animationSpeed=.1,this.sprite.play(),this.r=.05*big_dim,this.scale=this.r/this.sprite.width,this.sprite.scale.set(this.scale),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.maxspeed=4*stage_width/1e3,this.type=CharacterType.Cow,this.seekOpponent_count=0,this.seekOpponent_time=0,this.attack_count=0,this.attack_time=10,this.attacking=!1,this.Dead=!1,this.maxhp=5,this.hp=this.maxhp,this.healthbar=new HealthBar(this)},Cow.prototype.init=function(t){this.team=t.team,this.sprite.tint=t.color,this.pos.x=t.x,this.pos.y=t.y,stage.addChild(this.sprite),stage.addChild(this.healthbar.bar)},Cow.prototype.animationdisplay=function(){switch(this.animationtype){case AnimationType.Walk_Front:this.sprite.currentFrame>=this.front_attack_frame-1&&this.sprite.gotoAndPlay(this.front_walk_frame);break;case AnimationType.Attack_Front:this.sprite.currentFrame>=this.back_walk_frame-1&&(this.attacking=!1,this.animationtype=AnimationType.Walk_Front,null!=this.opponent&&(this.opponent.hp-=1,this.opponent.healthbar.set(this.opponent.hp)))}},Cow.prototype.clean=function(){this.sprite.stop(),stage.removeChild(this.sprite),stage.removeChild(this.healthbar.bar)},Cow.prototype.attack=function(){this.attacking||(this.animationtype!=AnimationType.Attack_Front&&this.sprite.gotoAndPlay(this.front_attack_frame),this.animationtype=AnimationType.Attack_Front,this.attacking=!0)},Cow.prototype.update=function(t){if(null==t||this.attacking||(applyForce.call(this,t.follow(this)),this.accel.mag()>width/10&&(this.animationtype=AnimationType.Walk_Front)),null!=this.opponent&&this.accel.mag()<width/1e3&&!this.attacking){if(this.seekOpponent_count++,this.seekOpponent_count<this.seekOpponent_time)return;this.seekOpponent_count=0,this.opponent_dist=findDist(this.pos,this.opponent.pos),(this.opponent_dist>=dim/2||this.opponent.isDead())&&(this.opponent=null,void 0==this.opponent_dist),this.opponent_dist>=1.5*this.r?(null!=this.opponent&&applyForce.call(this,this.seek(this.opponent.pos)),this.animationtype=AnimationType.Walk_Front):this.attack()}this.attacking||(this.vel=this.accel,this.vel.limit(this.maxspeed),this.pos.add(this.vel),this.accel.mult(0)),this.sprite.position.x=this.pos.x,this.sprite.position.y=this.pos.y,this.healthbar.update(),this.animationdisplay(),this.hp<=0&&(this.Dead=!0)},HealthBar.prototype={init:function(t){this.character=t,this.pos=this.character.pos,this.r=this.character.r,this.maxhp=this.character.maxhp,this.hp=this.maxhp,this.bar=new PIXI.Container,this.innerbar=new PIXI.Graphics,this.innerbar.beginFill(0),this.innerbar.drawRoundedRect(0,0,.6*this.r,this.r/12,this.r/24),this.innerbar.endFill(),this.bar.addChild(this.innerbar),this.outbar=new PIXI.Graphics,this.outbar.beginFill(16724736),this.outbar.drawRoundedRect(0,0,.6*this.r,this.r/12,this.r/24),this.outbar.endFill(),this.bar.addChild(this.outbar),this.bar.outer=this.outbar},set:function(t){var i=t/this.maxhp;0>=t&&(this.character.Dead=!0,i=0),this.outbar.scale.x=i},update:function(){this.bar.x=this.pos.x-this.r/4,this.bar.y=this.pos.y-3*this.r/8}};