function Communications(){this.init()}function onsomeevent(e){console.log("on some event")}function onGameList(e){}function sendName(e){username=e,communication.socket.emit("name",e),menu.multiplayermenu.init_main()}function joinGame(e){0>e||communication.socket.emit("join game",e)}function onjoinGameSuccess(e){console.log("onjoinGameSuccess"),console.log(e),myteam=e.team,ChatRoom=e.room,menu.multiplayermenu.init_gameroom()}function leaveGame(){communication.socket.emit("leave game"),ChatRoom="Global",gameChats=[],menu.multiplayermenu.init_main()}function startGame(){communication.socket.emit("start game")}function onstartGame(e){console.log("onstartGame"),console.log(e),startlocation=e.players[myteam].location,menu.multiplayermenu.init_game();for(var t=game.teams,a=0;a<game.players.length;a++){var n=game.players[a],c=n.team;c!=Team.Observer&&t[c].startmultiplayer(e.players[c])}}function sendChat(e){communication.socket.emit("chat",e)}function onChat(e){"[object Array]"===Object.prototype.toString.call(e)?e.forEach(function(e){placechat(e)}):placechat(e)}function onSyncPeriod(e){for(var t=0;t<e.players.length;t++)if(t==myteam&&(game.getTeam(t).coins=e.players[t].coins),void 0!=e.players[t].characters)for(var a=0;a<e.players[t].characters.length;a++)if(void 0!=e.players[t].characters[a])for(var n=e.players[t].characters[a].length-1;n>=0;n--){var c=e.players[t].characters[a][n],o=game.teams[t].characters[a][n];if(void 0!=c&&void 0!=o)if(o.id!=c.id,c.Dead)o.Dead=!0,characters.clean(o),e.players[t].characters[a].splice(n,1),game.teams[t].characters[a].splice(n,1);else if(0!=Server_Sync_Period_Estimate&&null!=e.players[t].characters[a][n].x&&"periodic"==e.sync_type){if(game.teams[t].characters[a][n].hp=e.players[t].characters[a][n].hp,t==myteam)continue;var r=e.players[t].characters[a][n].x*stage_width,i=e.players[t].characters[a][n].y*stage_height,s=findDist(game.teams[t].characters[a][n].pos,new PVector(r,i));s>=dim/30?(o.override=!0,o.predict.x=(c.x+Server_Sync_Period_Estimate*c.vx)*stage_width,o.predict.y=(c.y+Server_Sync_Period_Estimate*c.vy)*stage_height,isNaN(o.predict.x)):o.override=!1}}Server_Sync_gameCounts.push(gameCount),Server_Sync_gameCounts=Server_Sync_gameCounts.slice(-4);for(var m=0,t=1;t<Server_Sync_gameCounts.length;t++)m+=Server_Sync_gameCounts[t]-Server_Sync_gameCounts[t-1];Server_Sync_Period_Estimate=Math.ceil(m/(Server_Sync_gameCounts.length-1))}function onRequestedSync(e){game.teams[myteam].sync_force=!0,game.teams[myteam].sendPeriodicSync()}function onSpawnPeriod(e){for(var t=0;t<e.players.length;t++){var a=e.players[t];void 0!=a.id&&game.getTeam(t).spawn(a.id)}}function onSpawn(e){}function onDeadCharacter(e){var t=game.getTeam(e.team).characters[e.type][e.index];characters.clean(t),game.getTeam(e.team).characters[e.type].splice(e.index,1)}function onSpawnExisting(e){for(var t=0;t<e.characters.length;t++){var a=characters.spawn({x:e.characters[t].x*stage_width,y:e.characters[t].y*stage_height,type:e.characters[t].type,team:e.team,color:e.color,id:e.characters[t].id});game.getTeam(e.team).characters[e.characters[t].type].push(a)}game.getTeam(e.team).color=e.color}function onjoinServer(e){playerid=e.id}function onPath(e){game.getTeam(e.team).path.startPath(e.points[0].x*stage_width,e.points[0].y*stage_height),game.getTeam(e.team).path.endPath(e.points[1].x*stage_width,e.points[1].y*stage_height)}function onSync(e){for(var t=game.getTeam(e.team),a=0;a<e.characters.length;a++)if(void 0!=e.characters[a])for(var n=0;n<e.characters[a].length;n++)void 0!=t.characters[a][n]&&(t.characters[a][n].pos.x=e.characters[a][n].x*stage_width,t.characters[a][n].pos.y=e.characters[a][n].y*stage_height,t.characters[a][n].vel.x=e.characters[a][n].vx*stage_width,t.characters[a][n].vel.y=e.characters[a][n].vy*stage_height,t.characters[a][n].hp=e.characters[a][n].hp)}function addMessage(e,t,a,n){chatmonitor.prepend('<p><span "style="color:'+a+'"></span><span style="color:'+a+'">'+e+"</span> @ "+convertTime(n)+": "+t+"</p>")}var chatmonitor=$("#chatmonitor");Communications.prototype={init:function(){},connect:function(){return new Promise(function(e,t){communication.socket=io.connect("http://75.1.30.179:80/",{reconnection:!1}),setTimeout(function(){communication.socket.connected?(communication.setupconnection(),e()):(communication.socket.io._reconnection=!1,t())},1e3)})},setupconnection:function(){communication.sendClientInfo(),communication.socket.on("joinServer",onjoinServer),communication.socket.on("joinGameSuccess",onjoinGameSuccess),communication.socket.on("start game",onstartGame),communication.socket.on("dead character",onDeadCharacter),communication.socket.on("path",onPath),communication.socket.on("sync",onSync),communication.socket.on("spawn period",onSpawnPeriod),communication.socket.on("periodic server sync",onSyncPeriod),communication.socket.on("request server sync",onRequestedSync),communication.socket.on("some event",onsomeevent)},sendClientInfo:function(){this.socket.emit("client info",{width:width,height:height,stage_width:stage_width,stage_height:stage_height})},update:function(e){}};