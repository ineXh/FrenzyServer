var ScreenPos={left:0,right:0,top:0,bot:0},getScreenPos=function(){ScreenPos.left=-stage.x,ScreenPos.right=-stage.x+width/stage.scale.x,ScreenPos.top=-stage.y,ScreenPos.bot=-stage.y+height/stage.scale.y},onScreen=function(a){if("path"==a._class)return!0;setBorder(a);var b=a.right<ScreenPos.left-.2*width,c=a.left>ScreenPos.right+.2*width,d=a.bot<ScreenPos.top-.2*height,e=a.top>ScreenPos.bot+.2*height;return!(c||b||e||d)},setBorder=function(a){a.left=a.x,a.right=a.x+a.width,a.top=a.y,a.bot=a.y+a.height},visiblecount=0,visibleCheck=function(){if(visiblecount++,visiblecount%40==0){visiblecount=0,getScreenPos();for(var a=0;a<stage.children.length;a++)onScreen(stage.children[a])?stage.children[a].visible=!0:stage.children[a].visible=!1}},panCenter=function(){gamestate==GameState.InPlay&&pan()},pan=function(){MousePos.touched&&(MousePos.x>width-scope_width?(stage.x-=width/100,stage.x<-stage_width+width&&(stage.x=-stage_width+width)):MousePos.x<scope_width&&(stage.x+=width/100,stage.x>0&&(stage.x=0)),MousePos.y>height-scope_height?(stage.y-=height/100,stage.y<-stage_height+height&&(stage.y=-stage_height+height)):MousePos.y<scope_height&&(stage.y+=height/100,stage.y>0&&(stage.y=0)))},stageborder=function(){stage.x<-stage_width+width&&(stage.x=-stage_width+width),stage.x>0&&(stage.x=0),stage.y<-stage_height+height&&(stage.y=-stage_height+height),stage.y>0&&(stage.y=0)},panTo=function(a,b){stage.x=-a,stage.y=-b,stageborder()};