function ParticlesPool(){this.complete=!1,this.loadPool(),this.complete=!0}function Particles(){this.init(),this.pool=new ParticlesPool,this.createLookupTables()}function Particle(a,b,c){this.create(a,b,c)}function Text(a,b){this.input=a,this.type=b,this.sprite=new PIXI.extras.BitmapText("",{font:a.font,fill:a.fill,align:"center",stroke:"#FF0000",strokeThickness:3}),this.sprite.tint=RGBColor(255,0,0)}ParticlesPool.prototype={loadPool:function(){this.createText(),this.createIcon()},createIcon:function(){this.Icons=[]},borrowIcon:function(){return this.Icons.length>=1?this.Icons.shift():null},returnIcon:function(a){this.Icons.push(a)},createFlame:function(){this.flames=[],this.addFlameSprites(2)},addFlameSprites:function(a){for(var b=0;a>b;b++){var c=new PIXI.Sprite(flame_texture);c.tint=RGBColor(getRandomInt(230,255),getRandomInt(100,200),0),c.anchor.x=.5,c.anchor.y=.45;var d=new Particle(null,ParticleType.FLAME,c);this.flames.push(d)}},borrowFlame:function(){return this.flames.length>=1?this.flames.shift():null},returnFlame:function(a){this.flames.push(a)},createText:function(){this.texts=[],this.addText(8)},addText:function(a){console.log("addText");for(var b=0;a>b;b++){var c=new Text({font:"40px Ninja Naruto",fill:"black"},ParticleType.TEXT);this.texts.push(c)}},borrowText:function(){return this.texts.length>=1?this.texts.shift():null},returnText:function(a){this.texts.push(a)}},Particles.prototype={init:function(){this.particles=[],this.queue_particles=[]},getLength:function(){return this.particles.length},update:function(a){for(var b=this.particles.length-1;b>=0;b--){var c=this.particles[b];c.update(a),c.isDead()&&(null!=c.cb_dead&&c.cb_dead(),this.clean(c),this.particles.splice(b,1))}this.update_queue(a)},update_queue:function(a){if(!(this.queue_particles.length<1)){var b=this.queue_particles[0];b.isDead()?(this.queue_particles.length>=2&&(this.queue_particles[1].init(this.queue_particles[1].input),this.queue_particles[1].time_s=a.t,null!=this.queue_particles[1].cb&&this.queue_particles[1].cb()),null!=b.cb_dead&&b.cb_dead(),this.clean(b),this.queue_particles.splice(0,1)):b.update(a)}},spawn:function(a,b){var c=this.borrowParticle(b);null!=c&&(c.init(a),this.particles.push(c))},clean:function(a){a.clean(),this.returnParticle(a.type,a)},spawn_queue:function(a,b,c){var d=this.borrowParticle(b);null!=d&&(this.queue_particles.length<1?d.init(a):d.input=a,this.queue_particles.push(d))},createLookupTables:function(){this.borrowParticleLookup=[],this.borrowParticleLookup[ParticleType.FLAME]=this.pool.borrowFlame,this.borrowParticleLookup[ParticleType.TEXT]=this.pool.borrowText,this.borrowParticleLookup[ParticleType.ICON]=this.pool.borrowIcon,this.returnParticleLookup=[],this.returnParticleLookup[ParticleType.FLAME]=this.pool.returnFlame,this.returnParticleLookup[ParticleType.TEXT]=this.pool.returnText,this.returnParticleLookup[ParticleType.ICON]=this.pool.returnIcon},borrowParticle:function(a){return this.borrowParticleLookup[a].call(this.pool)},returnParticle:function(a,b){return void 0==this.returnParticleLookup[a]?void(b=null):this.returnParticleLookup[a].call(this.pool,b)}},Particle.prototype={create:function(a,b,c){this.type=b,this.sprite=c},init:function(a){this.input=a,this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,a.track_ang&&(this.sprite.rotation=this.input.body.angle),a.play&&(this.sprite.animationSpeed=a.animationSpeed,this.sprite.play()),this.radius=Math.random()*width,this.oldRadius=this.radius,this.particle_init(a)},particle_init:function(a){this.sprite.x=a.x,this.sprite.y=a.y,this.pos=new PVector(a.x,a.y),null!=a.color&&(this.color=a.color),this.vel=new PVector(0,0),this.accel=new PVector(0,0),null!=a.ax&&(this.accel.x=a.ax),null!=a.ay&&(this.accel.y=a.ay),null!=a.x_end&&(this.x_start=a.x,a.x_end.length>=1?(this.index=0,this.x_end=a.x_end[0]):this.x_end=a.x_end),null!=a.y_end&&(this.y_start=a.y,a.y_end.length>=1?this.y_end=a.y_end[0]:this.y_end=a.y_end),void 0!=a.rs&&(this.rs=a.rs,this.r=this.rs,a.re.length>=1?this.re=a.re[0]:this.re=a.re,void 0==this.sprite||isNaN(this.r)||(this.sprite.width=this.rs),void 0==this.sprite||isNaN(this.r)||(this.sprite.height=this.rs)),null!=a.lifespan_s?this.lifespan_s=a.lifespan_s:this.lifespan_s=255,null!=a.lifespan_d?this.lifespan_d=a.lifespan_d:this.lifespan_d=5,this.lifespan=this.lifespan_s,this.pct=0,null!=a.duration?void 0!=a.duration.length?this.duration=a.duration[0]:this.duration=a.duration:this.duration=void 0,null==a.time&&(this.time_s=time.t),null!=a.cb?void 0!=a.cb.length?null!=a.cb[0]&&a.cb[0].call(this):a.cb.call(this):this.cb=null,null!=a.cb_dead?this.cb_dead=a.cb_dead:this.cb_dead=null,null!=a.does_not_die&&(this.does_not_die=a.does_not_die),void 0!=a.container?a.container.addChild(this.sprite):stage.addChild(this.sprite)},clean:function(){this.duration=null,this.cb_dead=null,this.lifespan_d=null,this.index=0,this.input.play&&this.sprite.stop(),stage.removeChild(this.sprite)},reset:function(){},update:function(a){this.vel.add(this.accel),this.pos.add(this.vel),this.accel.mult(0),this.sprite.rotation+=0,null!=this.duration?this.run_queue(a):(this.sprite.alpha=this.lifespan>0?this.lifespan/255:0,this.lifespan-=this.lifespan_d),void 0!=this.input.track_pos?(this.sprite.x=this.input.track_pos.x,this.sprite.y=this.input.track_pos.y):(this.sprite.x=this.pos.x,this.sprite.y=this.pos.y),1==this.input.track_ang&&(this.sprite.rotation=this.input.body.angle)},run_queue:function(a){this.pct=(a.t-this.time_s)/this.duration,void 0!=this.input.x_end&&void 0!=this.input.x_end.length&&this.index<this.input.x_end.length-1&&this.pct>1&&(this.pct-=1,void 0!=this.rs&&(this.rs=this.input.re[this.index]),void 0!=this.re&&(this.re=this.input.re[this.index+1]),this.x_start=this.input.x_end[this.index],this.y_start=this.input.y_end[this.index],this.x_end=this.input.x_end[this.index+1],this.y_end=this.input.y_end[this.index+1],void 0!=this.input.cb&&null!=this.input.cb[this.index+1]&&this.input.cb[this.index+1].call(this),this.duration=this.input.duration[this.index+1],this.time_s=a.t-this.duration*this.pct,this.index++),void 0!=this.input.x_end&&void 0!=this.input.x_end.length&&this.index==this.input.x_end.length-1&&this.pct>1&&(this.pct=1,this.duration=1),this.r=this.rs+(this.re-this.rs)*this.pct,void 0==this.sprite||isNaN(this.r)||(this.sprite.width=this.r),void 0==this.sprite||isNaN(this.r)||(this.sprite.height=this.r),null!=this.x_start&&(this.pos.x=this.x_start+(this.x_end-this.x_start)*this.pct),null!=this.y_start&&(this.pos.y=this.y_start+(this.y_end-this.y_start)*this.pct)},render:function(a){},isDead:function(){return this.does_not_die?!1:this.lifespan<=0||this.pct>=1}},Text.prototype=Object.create(Particle.prototype),Text.prototype.constructor=Particle,Text.prototype.init=function(a){this.sprite.text=a.text,stage.addChild(this.sprite),this.sprite.rotation=a.rotation,this.radius=Math.random()*width,this.oldRadius=this.radius,this.particle_init(a),null!=this.x_start&&(this.x_start=this.x_start-this.sprite.width/2),null!=this.x_end&&(this.x_end=this.x_end-this.sprite.width/2)};