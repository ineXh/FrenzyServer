function Path(t){this.team=t,this.points=[],this.line_pool=[],this.lines=[],this.radius=5,this.outer_radius=dim/5,this.maxline=3,this.num_lines=0,this.path_started=!1,this.init()}function seek(t,i){var e=PVector.sub(i,t.pos);e.normalize(),e.mult(t.maxspeed);var n=PVector.sub(e,t.vel);return n.limit(t.maxforce),n}Path.prototype={init:function(){this.debug=!0,this.path=new PIXI.Container,this.path._class="path",stage.addChild(this.path);for(var t=0;t<this.maxline;t++)this.line_pool.push(this.createArrow())},createArrow:function(){var t=new PIXI.Container;return t.pivot.x=0,t.pivot.y=0,arrow_line=new PIXI.Sprite(arrow_line_texture),arrow_line.anchor.x=0,arrow_line.anchor.y=.5,this.scale=width/20/arrow_line.width,arrow_line.scale.set(this.scale),arrow_line.width=0,arrow_line.x=0,arrow_line.y=0,arrow_line.tint=11154363,arrow_line.alpha=.2,t.addChild(arrow_line),arrow_head=new PIXI.Sprite(arrow_head_texture),arrow_head.scale.set(this.scale),arrow_head.anchor.x=.5,arrow_head.anchor.y=.5,arrow_head.x=0,arrow_head.y=0,arrow_head.tint=arrow_line.tint,arrow_head.alpha=arrow_line.alpha,t.addChild(arrow_head),t},addPoint:function(t,i){var e=new PVector(t,i);this.points.push(e)},getStart:function(){return this.points[0]},getEnd:function(){return this.points.length<=0?-1:this.points[this.points.length-1]},getEndLine:function(){return this.lines[this.lines.length-1]},getLastTwoPoints:function(){if(this.points.length<=1)return null;var t=[];return t.push(this.points[this.points.length-2]),t.push(this.points[this.points.length-1]),t},borrowline:function(){return this.line_pool.length>=1?this.line_pool.shift():(this.returnfirstline(),this.line_pool.shift())},returnfirstline:function(){this.points.splice(0,2),this.line_pool.push(this.lines.shift()),this.num_lines--},startPath:function(t,i){if(this.path_started)return void this.endPath(t,i);this.path_started=!0,this.addPoint(t,i);var e=this.borrowline();e.x=t,e.y=i,e.children[0].width=0,this.lines.push(e),e.children[0].tint=game.getTeam(this.team).color,e.children[1].tint=game.getTeam(this.team).color,this.path.addChild(e)},updatePath:function(t,i){this.path_started&&(p0=this.getEnd(),this.getEndLine().children[0].width=findDist(p0,new PVector(t,i)),this.getEndLine().children[1].x=this.getEndLine().children[0].width,this.getEndLine().rotation=Math.atan2(i-p0.y,t-p0.x))},endPath:function(t,i){this.path_started&&(this.updatePath(t,i),this.addPoint(t,i),this.num_lines++,this.path_started=!1)},drawPath:function(){for(var t=0;t<this.points.length-1;t++){var i=new PIXI.Graphics;i.lineStyle(30,170,.8);for(var e=this.points[t],n=this.points[t+1],r=findDist(e,n),a=new PIXI.Container,s=Math.floor(r/this.gap),h=0;s>h;h++)dot=new PIXI.Sprite(arrow_dot_texture),dot.anchor.x=.5,dot.anchor.y=.5,this.scale=3*this.gap/dot.width,dot.scale.set(this.scale),dot.x=(n.x-e.x)*h/(s+1)+e.x,dot.y=(n.y-e.y)*h/(s+1)+e.y,dot.tint=16776960,a.addChild(dot);i.moveTo(e.x,e.y),i.lineTo(n.x,n.y),this.path.addChild(i),this.path.addChild(a)}path_container.addChild(this.path)},follow:function(t){for(var i=new PVector(0,0),e=0;e<this.num_lines;e++){var n=this.points[2*e],r=this.points[2*e+1],a=getNormalPoint(t.pos,n,r);if(isBetween(a,n,r)&&withinDist(a,t.pos,this.outer_radius)){var s=PVector.sub(r,n);s.normalize();var h=s;i.add(h)}}return i.normalize(),i.mult(t.maxspeed),i},calculatefollowforce:function(t,i,e,n){var r=getNormalPoint(e,t,i),a=PVector.sub(i,t);a.normalize(),a.mult(50);var s=PVector.add(r,a);if(!isBetween(s,i,t))return new PVector(0,0);var h=PVector.dist(e,r);if(h>this.radius&&h<this.outer_radius){var o=seek(n,s);return o.mult(1),o}if(h<=this.radius){var o=i.clone();return o.sub(t),o.limit(1),o}return new PVector(0,0)}};