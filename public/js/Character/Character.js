function Characters(){this.pool=new CharacterPool,this.init()}function Character(){this.SteerClosestTarget=1,this.SteerTargets=[],this.searchClosestTime=0,this.searchClosestTotalTime=2e3,this.closestTarget_idx=-1,this.accel=new PVector(0,0),this.vel=new PVector(0,0),this.pos=new PVector(0,0),this.s_vel=new PVector(0,0),this.s_pos=new PVector(0,0),this.maxspeed=big_dim/200,this.override=!1,this.predict=new PVector(0,0),this.Dead=!1,this.dmg=0}function Cow(){this.create()}function HealthBar(t){this.init(t)}Characters.prototype={init:function(){this.characters=this.pool.initList()},getLength:function(){return this.characters.length},update:function(){for(var t=0;t<this.characters.length;t++)if(void 0!=this.characters[t])for(var e=this.characters[t].length-1;e>=0;e--){var i=this.characters[t][e];if(i.update(),i.isDead()){this.clean(i);var s=this.characters[i.type].indexOf(t);if(s>-1){this.characters[i.type][s];this.characters[i.type].splice(s,1)}this.characters.splice(t,1)}}},spawn:function(t){var e=this.pool.borrowCharacter(t.type);return null!=e?(e.init(t),e):null},clean_all:function(){for(var t=this.characters.length-1;t>=0;t--){var e=this.characters[t];this.clean(e);var i=this.getCharacterlist(e.type).indexOf(t);if(i>-1){var s=this.getCharacterlist(e.type)[i];this.getCharacterlist(e.type).splice(i,1),this.decrementCharacterlists(s)}this.characters.splice(t,1)}},clean:function(t){t.clean(),this.pool.returnCharacter(t.type,t)},getCharacterlist:function(t){return this.characterlist[t]}},Character.prototype=Object.create(Ball.prototype),Character.prototype.constructor=Ball,Character.prototype.applyBehaviors=function(t){var e=this.steer(t);this.applyForce(e)},Character.prototype.addTarget=function(t,e){for(var i=0;i<t.length;i++)if(t[i]==e)return;t.push(e)},Character.prototype.removeTarget=function(t,e){for(var i=0;i<t.length;i++)if(t[i]==e)return void t.splice(i,1)},Character.prototype.findClosestTarget=function(t,e){if(null==this.targets)return-1;this.minDist_idx=-1,minDist=big_dim;for(var i=0;i<t.length;i++){if(void 0!=t[i].target)var s=t[i].target;else var s=t[i];var a=findDist(e,s);a<minDist&&(void 0!=s.steer_distance?a<s.steer_distance&&(minDist=a,this.minDist_idx=i):(minDist=a,this.minDist_idx=i))}return this.minDist_idx},Character.prototype.steer=function(t){if(null==this.SteerTargets)return new PVector(0,0);if(this.SteerTargets.length<1)return new PVector(0,0);if(t.t-this.searchClosestTime>this.searchClosestTotalTime){for(var e=[],i=this.SteerTargets.length-1;i>=0;i--){var s=this.SteerTargets[i].target;s.isDead()?this.SteerTargets.splice(i,1):e.push(s.pos)}this.closestTarget_idx=this.findClosestTarget(e,this.pos),this.closestTarget_idx=this.SteerTargets.length-1-this.closestTarget_idx,this.searchClosestTime=t.t}var a=new PVector(0,0);if(-1!=this.closestTarget_idx&&void 0!=this.SteerTargets[this.closestTarget_idx]){if(withinDist(this.pos,this.SteerTargets[this.closestTarget_idx].target.pos,this.width+this.SteerTargets[this.closestTarget_idx].width))return a;a=this.seek(this.SteerTargets[this.closestTarget_idx].target.pos)}return a},Character.prototype.seek=function(t){var e=PVector.sub(t,this.pos);return e.normalize(),e.mult(this.maxspeed/2),e},Character.prototype.isDead=function(){return this.Dead},Cow.prototype=Object.create(Character.prototype),Cow.prototype.constructor=Character,Cow.prototype.create=function(){this.animationtype=AnimationType.Walk_Front,this.front_walk_frame=0,this.front_attack_frame=8,this.back_walk_frame=14,this.back_attack_frame=22,this.total_frame=cow_front_frames.length,this.pos=new PVector(0,0),this.vel=new PVector(0,0),this.s_pos=new PVector(0,0),this.s_vel=new PVector(0,0),this.accel=new PVector(0,0),this.sprite=new PIXI.extras.MovieClip(cow_front_frames),this.sprite.animationSpeed=.1,this.sprite.play(),this.r=.05*big_dim,this.scale=this.r/this.sprite.width,this.sprite.scale.set(this.scale),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.type=CharacterType.Cow,this.seekOpponent_count=0,this.seekOpponent_time=5,this.attack_count=0,this.attack_time=10,this.attacking=!1,this.Dead=!1,this.border=!0,this.maxhp=cow_max_hp,this.hp=this.maxhp,this.healthbar=new HealthBar(this),this.dmg=0,this.attack_base=2,this.attack_stat=this.attack_base,this.defense_base=1,this.defense_stat=this.defense_base,this.speed_base=3*big_dim/1e3,this.maxspeed=this.speed_base,this.override=!1,this.predict=new PVector(0,0),this.status=[]},Cow.prototype.init=function(t){void 0!=t.id&&(this.id=t.id),this.team=t.team,this.sprite.tint=t.color,this.upgrade_update(),this.pos.x=t.x,this.pos.y=t.y,this.vel.x=0,this.vel.y=0,this.s_pos.x=t.x,this.s_pos.y=t.y,this.s_vel.x=0,this.s_vel.y=0,stage.addChild(this.sprite),stage.addChild(this.healthbar.bar)},Cow.prototype.animationdisplay=function(){switch(this.animationtype){case AnimationType.Walk_Front:this.sprite.currentFrame>=this.front_attack_frame-1&&this.sprite.gotoAndPlay(this.front_walk_frame);break;case AnimationType.Attack_Front:if(this.sprite.currentFrame>=this.back_walk_frame-1&&(this.attacking=!1,this.animationtype=AnimationType.Walk_Front,null!=this.opponent)){var t=this.attack_stat-this.opponent.defense_stat;0>=t&&(t=1),this.opponent.hp<=t&&this.opponent.hp>0&&getCoin(this.team,this.opponent),gamemode==GameMode.SinglePlayer&&(this.opponent.hp-=t),this.team==myteam&&(this.opponent.dmg+=t)}break;case AnimationType.Walk_Back:this.sprite.currentFrame>=this.back_attack_frame-1&&this.sprite.gotoAndPlay(this.back_walk_frame);break;case AnimationType.Attack_Back:if(this.sprite.currentFrame>=this.total_frame&&(this.attacking=!1,this.animationtype=AnimationType.Walk_Back,null!=this.opponent)){var t=this.attack_stat-this.opponent.defense_stat;0>=t&&(t=1),this.opponent.hp<t&&this.opponent.hp>0&&getCoin(this.team,this.opponent),gamemode==GameMode.SinglePlayer&&(this.opponent.hp-=t),this.team==myteam&&(this.opponent.dmg+=t)}}},Cow.prototype.clean=function(){this.sprite.stop(),stage.removeChild(this.sprite),stage.removeChild(this.healthbar.bar)},Cow.prototype.attack=function(){this.attacking||(this.animationtype!=AnimationType.Attack_Front&&this.sprite.gotoAndPlay(this.front_attack_frame),this.animationtype=AnimationType.Attack_Front,this.attacking=!0)},Cow.prototype.update=function(t){this.animationdisplay(),null==t||this.attacking||this.override||(applyForce.call(this,t.follow(this)),this.accel.mag()>big_dim/10&&(this.animationtype=AnimationType.Walk_Front)),null!=this.opponent&&this.accel.mag()<big_dim/1e3&&!this.attacking&&(this.seekOpponent_count++,this.seekOpponent_count>=this.seekOpponent_time&&(this.seekOpponent_count=0,this.opponent_dist=findDist(this.pos,this.opponent.pos)),this.opponent_dist>=dim/2||this.opponent.isDead()?(this.opponent=null,void 0==this.opponent_dist):this.opponent_dist>=3*this.r/4+3*this.opponent.r/4?(null!=this.opponent&&applyForce.call(this,this.seek(this.opponent.pos)),this.animationtype=AnimationType.Walk_Front):this.attack()),this.attacking||(this.vel=this.accel,gamemode==GameMode.MultiPlayer&&this.team!=myteam&&this.override&&(this.vel.x=(this.predict.x-this.pos.x)/Server_Sync_Period_Estimate,this.vel.y=(this.predict.y-this.pos.y)/Server_Sync_Period_Estimate),this.vel.limit(this.maxspeed),this.pos.add(this.vel),this.accel.mult(0),this.border&&this.stayinBorder()),null!=this.opponent&&(this.opponent.pos.x>this.pos.x?this.sprite.scale.x=-Math.abs(this.sprite.scale.x):this.sprite.scale.x=Math.abs(this.sprite.scale.x)),this.sprite.position.x=this.pos.x,this.sprite.position.y=this.pos.y,isNaN(this.pos.x),this.healthbar.update(),this.collision_count=0,this.hp<=0&&(this.Dead=!0)},Cow.prototype.multisync_seek=function(){gamemode==GameMode.MultiPlayer&&(this.accel.mag()>0||(Math.abs(this.pos.x-this.s_pos.x)>=Client_Sync_Tolerance*stage_width||Math.abs(this.pos.y-this.s_pos.y)>=Client_Sync_Tolerance*stage_height)&&applyForce.call(this,this.seek(this.s_pos)))},Cow.prototype.upgrade_update=function(){this.attack_stat=this.attack_base+game.teams[this.team].attack_upgrades,this.defense_stat=this.defense_base+game.teams[this.team].defense_upgrades,this.maxspeed=this.speed_base*(1+.2*game.teams[this.team].speed_upgrades)},HealthBar.prototype={init:function(t){this.character=t,this.pos=this.character.pos,this.r=this.character.r,this.maxhp=this.character.maxhp,this.hp=this.maxhp,this.bar=new PIXI.Container,this.innerbar=new PIXI.Graphics,this.innerbar.beginFill(0),this.innerbar.drawRoundedRect(0,0,.6*this.r,this.r/12,this.r/24),this.innerbar.endFill(),this.bar.addChild(this.innerbar),this.outbar=new PIXI.Graphics,this.outbar.beginFill(16724736),this.outbar.drawRoundedRect(0,0,.6*this.r,this.r/12,this.r/24),this.outbar.endFill(),this.bar.addChild(this.outbar),this.bar.outer=this.outbar},set:function(t){var e=t/this.maxhp;0>=t&&(this.character.Dead=!0,e=0),this.outbar.scale.x=e},update:function(){this.hp!=this.character.hp&&(this.hp=this.character.hp,this.set(this.hp)),this.bar.x=this.pos.x-this.r/4,this.bar.y=this.pos.y-3*this.r/8}};